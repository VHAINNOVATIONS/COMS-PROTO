<!doctype html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
        <title>GIT Issues for Chemotherapy Order Management System (COMS)</title>

        <!-- CSS : ExtJS 4.0 Framework      -->
        <link rel="stylesheet" type="text/css" href="/libs/ExtJS_4.1RC1/resources/css/ext-all.css">

        <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
        <script src="/libs/modernizr-2.0.6.js"></script>

    </head>
<body>
<div id="GridPanel"></div>
 <script type="text/javascript" src="/libs/ExtJS_4.1RC1/ext-all-debug.js"></script>

<script>
Ext.onReady(function(){
	var minWidth = Ext.getBody().getViewSize().width - 150;
	var minHeight = Ext.getBody().getViewSize().height - 200;
	if (minWidth < 0) {
		minWidth = 200;
	}
	if (minHeight < 0) {
		minHeight = 200;
	}
	var puWin = function(title, msg) {
		var bodyWin = Ext.create("Ext.window.Window", { 
			title: title,
			layout: "fit",
			html: msg,
			minWidth: minWidth,
			minHeight: minHeight,
			autoScroll: true,
			bodyPadding: '10',
			modal: true
		});
		bodyWin.show();
	}

    Ext.define('Issue', {
        extend: 'Ext.data.Model',
        fields: ['url', 'number', 'title', 'state', 'created_at', 'label', 'body'],
    });

    var store = Ext.create('Ext.data.Store', {
        autoLoad: true,
        model: "Issue",
        groupField: "label",
        proxy: {
            type: "rest",
            url: "/Git/ListIssues",
            reader: {
                type: "json",
                root: "records"
            }
        }
    });

    var grid = Ext.create('Ext.grid.Panel', {
        selType: 'rowmodel',
        title: 'Backlogs and Defects',
        store: store,
        margin: '25',
        frame: true,
		layout: "fit",
		features: [{
            ftype: 'grouping'
        }],
		listeners: {
			'cellclick': function(scope, td, cellIndex, record, tr, rowIndex, e, eOpts) {
				puWin(record.data.title, record.data.body);
				// Ext.Msg.alert(record.data.title, record.data.body);
			}
		},

        columns: [
            { text: 'Issue #', dataIndex: 'number', width:50, autoSizeColumn: true},
            { text: 'Issue Title', dataIndex: 'title', flex: 2, autoSizeColumn: true },
            { text: 'State', dataIndex: 'state', width:50, autoSizeColumn: true},
            { text: 'Opened on', dataIndex: 'created_at', autoSizeColumn: true, renderer: function(value) {
                    return value.substring(0, 10);
                }
            },
            { text: '', labelSeparator: '', dataIndex: 'label', hidden: true}
        ],
        renderTo: Ext.getBody()
    });

	Ext.EventManager.onWindowResize(function () {
        var tmpWidth = Ext.getBody().getViewSize().width - 50;
		var tmpHeight = Ext.getBody().getViewSize().height - 160;
        grid.setSize(tmpWidth, tmpHeight);
    });

		var tmpWidth = Ext.getBody().getViewSize().width - 50;
		var tmpHeight = Ext.getBody().getViewSize().height - 160;
        grid.setSize(tmpWidth, tmpHeight);

});
</script>
</body>
</html>


